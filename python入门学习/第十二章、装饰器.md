![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1679990147743-faf8b516-421d-4fea-9543-e7758ef3f926.png)

<h2 id="Sr9pp"><font style="color:rgb(18, 18, 18);">ä¸€ è£…é¥°å™¨ä»‹ç»</font></h2>
<h2 id="zfHN0">1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ</h2>

```python

"""
å™¨æŒ‡çš„æ˜¯å·¥å…·ï¼Œå¯ä»¥å®šä¹‰æˆå‡½æ•°
    è£…é¥°æŒ‡çš„æ˜¯ä¸ºå…¶ä»–äº‹ç‰©æ·»åŠ é¢å¤–çš„ä¸œè¥¿ç‚¹ç¼€

    åˆåˆ°ä¸€èµ·çš„è§£é‡Šï¼š
        è£…é¥°å™¨æŒ‡çš„å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯ç”¨æ¥ä¸ºå…¶ä»–å‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½
"""

```

<h2 id="YIFbQ"><font style="color:rgb(18, 18, 18);">1.2 ä¸ºä½•è¦ç”¨è£…é¥°å™¨</font></h2>

```python

'''
å¼€æ”¾å°é—­åŸåˆ™
        å¼€æ”¾ï¼šæŒ‡çš„æ˜¯æ‹“å±•åŠŸèƒ½æ˜¯å¼€æ”¾çš„
        å°é—­ï¼šæŒ‡çš„æ˜¯å¯¹ä¿®æ”¹æºä»£ç æ˜¯å°é—­çš„
    è£…é¥°å™¨å°±æ˜¯åœ¨ä¸ä¿®æ”¹è¢«è£…é¥°å¯¹è±¡æºä»£ç ä»¥åŠè°ƒç”¨æ–¹å¼çš„å‰æä¸‹ï¼Œæœªè¢«è£…é¥°å¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½ã€‚
'''




Python 3.6.8 (tags/v3.6.8:3c6b436a57, Dec 23 2018, 23:31:17) [MSC v.1916 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import time
>>> time.time()
1679925108.0940278
>>> time.sleep(3)
>>> start=time.time()
>>> time.sleep(3)
>>> stop=time.time()
>>> stop - start
17.41496443748474

```



<h2 id="Mup37"><font style="color:rgb(18, 18, 18);">äºŒ è£…é¥°å™¨çš„å®ç°</font></h2>
<h3 id="Rxkxc"><font style="background-color:#FBDE28;">2.1 éœ€æ±‚ï¼š åœ¨ä¸ä¿®æ”¹indexå‡½æ•°çš„æºä»£ç ä»¥åŠè°ƒç”¨æ–¹å¼å‰æä¸‹,ä¸ºææ·»åŠ ä»£ç è¿è¡Œæ—¶é—´çš„åŠŸèƒ½ï¼ˆæ— å‚è£…é¥°å™¨ï¼‰</font></h3>

```python

def index(x,y):
    time.sleep(3)
    print('index %s %s' %(x,y))

index(111,222)

```

è§£å†³æ–¹æ¡ˆä¸€ï¼š

```python

# è§£å†³æ–¹æ¡ˆä¸€ï¼š å¤±è´¥
# é—®é¢˜ï¼šæ²¡æœ‰ä¿®æ”¹è¢«è£…é¥°å¯¹è±¡çš„è°ƒç”¨æ–¹å¼ï¼Œä½†æ˜¯ä¿®æ”¹äº†æºä»£ç 
import time
def index(x,y):
    start=time.time()
    time.sleep(3)
    print('index %s %s' %(x,y))
    stop=time.time()
    print(stop - start )

index(111,222)
# è¾“å‡ºç»“æœï¼š
index 111 222d
3.0093908309936523

```

#### è§£å†³æ–¹æ¡ˆäºŒï¼š

```python

# è§£å†³æ–¹æ¡ˆäºŒï¼š
# é—®é¢˜ï¼šæ²¡æœ‰ä¿®æ”¹è¢«è£…é¥°å¯¹è±¡çš„è°ƒç”¨æ–¹å¼ï¼Œä¹Ÿæ²¡æœ‰ä¿®æ”¹äº†æºä»£ç ï¼Œå¹¶ä¸”åŠ ä¸Šäº†æ–°åŠŸèƒ½ï¼Œä½†æ˜¯ä»£ç å†—ä½™ã€‚
import time
def index(x,y):
    time.sleep(3)
    print('index %s %s' %(x,y))

start=time.time()
index(111,222)
stop=time.time()
print(stop - start)

```

è§£å†³æ–¹æ¡ˆä¸‰ï¼š

```python

# é—®é¢˜ï¼šè§£å†³äº†æ–¹æ¡ˆäºŒçš„ä»£ç å†—ä½™é—®é¢˜ï¼Œä½†æ˜¯å¸¦æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå³å‡½æ•°çš„è°ƒç”¨æ–¹å¼
import time
def index(x,y):
    time.sleep(3)
    print('index %s %s' %(x,y))
def wrapper():
    start=time.time()
    index(111,222)
    stop=time.time()
    print(stop - start)

wrapper()

```

#### æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–0ï¼š

```python

# æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–0ï¼š
import time
def index(x,y):
    time.sleep(3)
    print('index %s %s' %(x,y))
def wrapper(a,b):  # a=111,b=222
    start=time.time()
    index(a,b)  # index(111,222)
    stop=time.time()
    print(stop - start)

wrapper(333,444)

```



#### æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–1ï¼šæŠŠindexçš„å‚æ•°å†™æ´»äº†

```python

# æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–1ï¼šæŠŠindexçš„å‚æ•°å†™æ´»äº†
import time
def index(x,y,z):
    time.sleep(3)
    print('index %s %s %s' %(x,y,z))
def wrapper(*args,**kwargs):
    start=time.time()
    index(*args,**kwargs)
    stop=time.time()
    print(stop - start)

wrapper(333,444,555)
wrapper(3333,y=4444,z=5555)
# è¾“å‡ºç»“æœï¼š
index 333 444 555
3.0126049518585205
index 3333 4444 5555
3.0091922283172607

```

æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–2ï¼šåœ¨ä¼˜åŒ–1çš„åŸºç¡€ä¸Šï¼ŒæŠŠè¢«è£…é¥°å¯¹è±¡å†™æ´»äº†ï¼ŒåŸæ¥åªèƒ½è£…é¥°index

```python

# æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–2ï¼šåœ¨ä¼˜åŒ–1çš„åŸºç¡€ä¸Šï¼ŒæŠŠè¢«è£…é¥°å¯¹è±¡å†™æ´»äº†ï¼ŒåŸæ¥åªèƒ½è£…é¥°index
import time
def index(x,y,z):
    time.sleep(3)
    print('index %s %s %s' %(x,y,z))
print(index)  # <function index at 0x023345D0>
def outter(func):
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):
        start=time.time()
        func(*args,**kwargs)  # indexå†…å­˜åœ°å€()
        stop=time.time()
        print(stop - start)
    return wrapper  # å…¶å®å°±æ˜¯ä¸ºäº†æ‰”åˆ°å…¨å±€ï¼Œå› ä¸ºå½“åˆwrapperæ˜¯å…¨å±€ï¼Œç°åœ¨ç¼©è¿›äº†å‡½æ•°å†…ã€‚

index=outter(index)  # f=outter(indexçš„å†…å­˜åœ°å€)---ã€‹åç»­ä¼šæœ‰è¯­æ³•ç³–çš„ä»‹ç»
print(index)  # <function outter.<locals>.wrapper at 0x01D0B660>
# f=å½“åˆé‚£ä¸ªwrapperå‡½æ•°çš„å†…å­˜åœ°å€
index(11,22,33)
index(x=1,y=2,z=3)

```

#### æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–3ï¼šå°†wrapperåšçš„è·Ÿè¢«è£…é¥°å¯¹è±¡ä¸€æ¨¡ä¸€æ ·ï¼Œä»¥å‡ä¹±çœŸã€‚

```python

# æ–¹æ¡ˆä¸‰çš„ä¼˜åŒ–3ï¼šå°†wrapperåšçš„è·Ÿè¢«è£…é¥°å¯¹è±¡ä¸€æ¨¡ä¸€æ ·ï¼Œä»¥å‡ä¹±çœŸã€‚
import time
def index(x,y,z):
    time.sleep(3)
    print('index %s %s %s' %(x,y,z))

def home(name):
    time.sleep(2)
    print('welcome %s to  home page' %name)
    return 123  # 3.å‡è®¾åŸå‡½æ•°æœ‰è¿”å›å€¼

def outter(func):
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):  # æ¥æ”¶ä»»æ„å‚æ•°
        start=time.time()
        res=func(*args,**kwargs)  # å°†homeçš„è¿”å›å€¼ä¼ªè£…æˆwrapperçš„è¿”å›å€¼ï¼Œ# 1. è°ƒç”¨åŸå‡½æ•°å¹¶ä¿å­˜è¿”å›å€¼
        stop=time.time()
        print(stop - start)  
        return res                # 2. è¿”å›åŸå‡½æ•°çš„è¿”å›å€¼
    return wrapper  # å…¶å®å°±æ˜¯ä¸ºäº†æ‰”åˆ°å…¨å±€ï¼Œå› ä¸ºå½“åˆwrapperæ˜¯å…¨å±€ï¼Œç°åœ¨ç¼©è¿›äº†å‡½æ•°å†…ã€‚
# å·æ¢æ¢æŸ±ï¼šhomeè¿™ä¸ªåå­—æŒ‡å‘çš„wrapperå‡½æ•°çš„å†…å­˜åœ°å€
home=outter(home)
res=home('egon')  # res=wrapper('egon')
print('è¿”å›å€¼==ã€‹',res)  # è¿”å›å€¼==ã€‹ 123

```

<img width="734" height="195" alt="image" src="https://github.com/user-attachments/assets/0e47b32d-5221-4025-bb2a-717dcf470d62" />

'''
1. res = func(*args, **kwargs)

è°ƒç”¨åŸå‡½æ•°ï¼šæ‰§è¡Œè¢«è£…é¥°çš„åŸå‡½æ•° indexã€‚
ä¿å­˜è¿”å›å€¼ï¼šå°† index() çš„è¿”å›å€¼ï¼ˆä¾‹å¦‚ 100ï¼‰èµ‹å€¼ç»™å˜é‡ resã€‚
(è‹¥ä¸ä¿å­˜è¿”å›å€¼ï¼ŒåŸå‡½æ•°çš„è¾“å‡ºç»“æœä¼šä¸¢å¤±ï¼)

2. return res

è¿”å›åŸå‡½æ•°çš„ç»“æœï¼šç¡®ä¿è£…é¥°åçš„ index() çš„è¿”å›å€¼ä¸åŸå‡½æ•°ä¸€è‡´ã€‚
(è‹¥çœç•¥è¿™ä¸€æ­¥ï¼Œindex() å°†è¿”å› Noneï¼)

'''



#### è§£å†³æ–¹æ¡ˆå››ï¼šå¦‚ä½•åœ¨æ–¹æ¡ˆä¸‰çš„åŸºç¡€ä¸Šä¸æ”¹å˜å‡½æ•°çš„è°ƒç”¨æ–¹å¼

```python

# è§£å†³æ–¹æ¡ˆå››ï¼šå¦‚ä½•åœ¨æ–¹æ¡ˆä¸‰çš„åŸºç¡€ä¸Šä¸æ”¹å˜å‡½æ•°çš„è°ƒç”¨æ–¹å¼
#

"""
è¯­æ³•ç³–çš„å®šä¹‰

"""
import time
# è£…é¥°å™¨
def timmer(func):            
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):  # æ¥æ”¶ä»»æ„å‚æ•°
        start=time.time()
        res=func(*args,**kwargs)  # 1. è°ƒç”¨åŸå‡½æ•°å¹¶ä¿å­˜è¿”å›å€¼
        stop=time.time()
        print(stop - start)
        return res  # 2. è¿”å›åŸå‡½æ•°çš„è¿”å›å€¼
    return wrapper


# åœ¨è¢«è£…é¥°å¯¹è±¡æ­£ä¸Šæ–¹çš„å•ç‹¬ä¸€è¡Œå†™@è£…é¥°å™¨åå­—
@timmer  # index=timmer(index)
def index(x,y,z):
    time.sleep(3)
    print('index %s %s %s' %(x,y,z))

@timmer  # home=timmer(home)
def home(name):
    time.sleep(2)
    print('welcome %s to  home page' %name)
    return 123

# è°ƒç”¨å‡½æ•°
index(x=1,y=2,z=3)
home('egon')

```

<h2 id="Uzq5B">2.2æ€»ç»“ï¼šæ— å‚è£…é¥°å™¨çš„æ¨¡æ¿</h2>

```python

def outter(func):
    def wrapper(*args,**kwargs):
        1ã€è°ƒç”¨åŸå‡½æ•°
        2ã€ä¸ºå…¶å¢åŠ æ–°åŠŸèƒ½
        res=func(*args,**kwargs)
        return res
    return wrapper


# ç®€å•ç¤ºä¾‹
def timmer(func):
    def wrapper(*args, **kwargs):
        res = func(*args, **kwargs)
        return res
    return wrapper

def index():
    print('from index')

index()


### é€è¡Œè§£æ

1. è£…é¥°å™¨å®šä¹‰
def timmer(func):            # æ¥æ”¶è¢«è£…é¥°çš„å‡½æ•°ï¼ˆå¦‚ index æˆ– homeï¼‰
    def wrapper(*args, **kwargs):  # æ¥æ”¶ä»»æ„å‚æ•°ï¼ˆå…¼å®¹åŸå‡½æ•°å‚æ•°ï¼‰
        start = time.time()        # è®°å½•å¼€å§‹æ—¶é—´
        res = func(*args, **kwargs)  # è°ƒç”¨åŸå‡½æ•°å¹¶ä¿å­˜è¿”å›å€¼ï¼ˆå…³é”®ç‚¹ï¼ï¼‰
        stop = time.time()         # è®°å½•ç»“æŸæ—¶é—´
        print(stop - start)        # æ‰“å°è€—æ—¶
        return res                 # è¿”å›åŸå‡½æ•°çš„è¿”å›å€¼ï¼ˆç»´æŒåŸè¡Œä¸ºï¼‰
    return wrapper                 # è¿”å›åŒ…è£…åçš„å‡½æ•°


2. ä½¿ç”¨è£…é¥°å™¨

@timmer  # ç­‰ä»·äº index = timmer(index)
def index(x, y, z):
    time.sleep(3)
    print('index %s %s %s' % (x, y, z))

@timmer  # ç­‰ä»·äº home = timmer(home)
def home(name):
    time.sleep(2)
    print('welcome %s to home page' % name)
    return 123  # åŸå‡½æ•°æœ‰è¿”å›å€¼


3. è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°
index(x=1, y=2, z=3)  # ä¿æŒåŸè°ƒç”¨æ–¹å¼ï¼ˆå…³é”®å­—å‚æ•°ï¼‰
home('egon')          # ä¿æŒåŸè°ƒç”¨æ–¹å¼ï¼ˆä½ç½®å‚æ•°ï¼‰





```
è§£é‡Š

<img width="873" height="759" alt="image" src="https://github.com/user-attachments/assets/2eaed93e-abab-4516-94ab-754977ae3a11" />

<img width="554" height="371" alt="image" src="https://github.com/user-attachments/assets/94a3a34e-1803-4b83-b5d9-fea793ed25db" />




'''
### @timmer  # ç­‰ä»·äº home = timmer(home) è§£é‡Šä¸‹

###### åŸæ–‡
@timmer  # ç­‰ä»·äº index = timmer(index)
def index(x, y, z):
    # ... åŸå‡½æ•°é€»è¾‘ ...

###### ç­‰ä»·äºï¼š
def index(x, y, z):  # 1. å®šä¹‰åŸå‡½æ•°
    # ... åŸå‡½æ•°é€»è¾‘ ...

index = timmer(index)  # 2. æ‰‹åŠ¨è£…é¥°ï¼šæŠŠåŸå‡½æ•°ä¼ é€’ç»™è£…é¥°å™¨ï¼Œè¦†ç›–åŸå‡½æ•°å


### 1ï¼‰å…³é”®æ­¥éª¤è§£æ
### 1.åŸå§‹å‡½æ•°å®šä¹‰
å®šä¹‰ index å‡½æ•°æ—¶ï¼Œå®ƒæŒ‡å‘è‡ªå·±çš„ä»£ç å—ï¼ˆå†…å­˜åœ°å€ä¸º 0x1000ï¼‰ã€‚

### 2.åº”ç”¨è£…é¥°å™¨
#### é€šè¿‡ @timmer æˆ–æ‰‹åŠ¨æ‰§è¡Œ index = timmer(index)ï¼Œå®é™…å‘ç”Ÿä»¥ä¸‹æ“ä½œï¼š

* è°ƒç”¨è£…é¥°å™¨å‡½æ•°ï¼šå°†åŸå‡½æ•° index ä½œä¸ºå‚æ•°ä¼ ç»™ timmer(func)ã€‚
* è¿”å›åŒ…è£…å‡½æ•°ï¼štimmer è¿”å›å†…éƒ¨å‡½æ•° wrapperï¼ˆå†…å­˜åœ°å€ä¸º 0x2000ï¼‰ã€‚
* è¦†ç›–åŸå‡½æ•°åï¼šå°†å˜é‡ index é‡æ–°èµ‹å€¼ä¸º wrapper å‡½æ•°ã€‚


'''

<img width="686" height="171" alt="image" src="https://github.com/user-attachments/assets/fd3b81a3-746f-44ee-ab92-541d1f81038f" />



ç¤ºä¾‹1===æ‰“å°è¿è¡Œä»£ç çš„æ—¶é—´çš„è£…é¥°å™¨

```python

# ç¤ºä¾‹1===æ‰“å°è¿è¡Œä»£ç çš„æ—¶é—´çš„è£…é¥°å™¨
def timmer(func):
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):
        start=time.time()
        time.sleep(2)
        res=func(*args,**kwargs)
        stop=time.time()
        print(stop - start)
        return res
    return wrapper

@timmer
def index():
    print('from index')

index()

# è¾“å‡ºç»“æœï¼š
from index
2.012852191925049

```

ç¤ºä¾‹2===è®¤è¯åŠŸèƒ½çš„è£…é¥°å™¨

```python

# ç¤ºä¾‹2===è®¤è¯åŠŸèƒ½çš„è£…é¥°å™¨
def auth(func):
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):
        #         1ã€è°ƒç”¨åŸå‡½æ•°
        #         2ã€ä¸ºå…¶å¢åŠ æ–°åŠŸèƒ½
        name=input('your name>>>: ').strip()
        password=input('your password>>>: ').strip()
        if name == 'egon' and password == '123':
            res=func(*args,**kwargs)
            return res
        else:
            print('è´¦å·å¯†ç è¾“å…¥é”™è¯¯')
    return wrapper

@auth
def index():
    print('from index')

index()

```

<h2 id="puHcl">2.3 wrapsè£…é¥°å™¨è¡¥å……</h2>
**<font style="color:#DF2A3F;">å·æ¢æ¢æŸ±ï¼šå³å°†åŸå‡½æ•°åæŒ‡å‘çš„å†…å­˜åœ°å€å·æ¢æ¢æŸ±æˆwrapperå‡½æ•°ï¼Œæ‰€ä»¥åº”è¯¥å°†wrapperåšçš„è·ŸåŸå‡½æ•°ä¸€æ ·æ‰è¡Œã€‚</font>**

**<font style="color:#DF2A3F;">å…³é”®ä¼ªè£…ï¼šå‚æ•°ã€è¿”å›å€¼ã€å±æ€§</font>**

```python

# ç¤ºä¾‹1====æ‰‹åŠ¨å°†åŸå‡½æ•°çš„å±æ€§èµ‹å€¼ç»™wrapperå‡½æ•°
def outter(func):
    def wrapper(*args,**kwargs):
        res=func(*args,**kwargs)  # res=index(1,2)
        return res
    # ä¸€ã€æ‰‹åŠ¨å°†åŸå‡½æ•°çš„å±æ€§èµ‹å€¼ç»™wrapperå‡½æ•°
    # 1ã€å‡½æ•°wrapper.__name__ = åŸå‡½æ•°.__name__
    # 2ã€å‡½æ•°wrapper.__doc__ = åŸå‡½æ•°.__doc__
    wrapper.__name__ = func.__name__
    wrapper.__doc__ = func.__doc__
    return wrapper

@outter  # index=outter(index)
def index(x,y):
    """è¿™æ˜¯ä¸»é¡µåŠŸèƒ½"""
    print(x,y)

print(index.__name__)
print(index.__doc__)

help() çœ‹çš„å°±æ˜¯å‡½æ•°æ–‡æ¡£æ³¨é‡Šä¿¡æ¯
print(help(index))

index(1,2)  # wrapper(1,2)






# ç¤ºä¾‹2===è‡ªåŠ¨å°†åŸå‡½æ•°çš„å±æ€§èµ‹å€¼ç»™wrapperå‡½æ•°

from functools import wraps
def outter(func):
    # äºŒã€è‡ªåŠ¨å°†åŸå‡½æ•°çš„å±æ€§èµ‹å€¼ç»™wrapperå‡½æ•°
    @wraps(func)
    def wrapper(*args,**kwargs):
        res=func(*args,**kwargs)  # res=index(1,2)
        return res
    # æ‰‹åŠ¨å°†åŸå‡½æ•°çš„å±æ€§èµ‹å€¼ç»™wrapperå‡½æ•°
    # 1ã€å‡½æ•°wrapper.__name__ = åŸå‡½æ•°.__name__
    # 2ã€å‡½æ•°wrapper.__doc__ = åŸå‡½æ•°.__doc__
    # wrapper.__name__ = func.__name__
    # wrapper.__doc__ = func.__doc__
    return wrapper

@outter  # index=outter(index)
def index(x,y):
    """è¿™æ˜¯ä¸»é¡µåŠŸèƒ½"""
    print(x,y)

print(index.__name__)
print(index.__doc__)

index(1,2)  # wrapper(1,2)






```

<h2 id="IJ3Sk">2.4 æœ‰å‚è£…é¥°å™¨çš„å®ç°</h2>

```python

# ç”±äºè¯­æ³•ç³–@çš„é™åˆ¶ï¼Œoutterå‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”è¯¥å‚æ•°åªç”¨æ¥æ¥æ”¶è¢«è£…é¥°å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚
def outter(func):
    # func = å‡½æ•°çš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):
        res=func(*args,**kwargs)  # res=index(1,2)
        return res
    return wrapper

@outter  # index=outter(index) index ==ã€‹wrapper
def index(x,y):
    print(x,y)

index(1,2)  # wrapper(1,2)

# é‡ç‚¹ï¼šå·æ¢æ¢æŸ±ä¹‹å
indexçš„å‚æ•°ä»€ä¹ˆæ ·å­ï¼Œwrapperçš„å‚æ•°å°±åº”è¯¥ä»€ä¹ˆæ ·å­
indexçš„è¿”å›å€¼ä»€ä¹ˆæ ·å­ï¼Œwrapperçš„è¿”å›å€¼å°±åº”è¯¥ä»€ä¹ˆæ ·å­
indexçš„å±æ€§ä»€ä¹ˆæ ·å­ï¼Œwrapperçš„å±æ€§å°±åº”è¯¥ä»€ä¹ˆæ ·å­==ã€‹ from functools import wraps


# # ç¤ºä¾‹1ï¼šç›´æ¥åœ¨authåé¢ä¼ å‚ï¼Œä¸ä½¿ç”¨è¯­æ³•ç³–ï¼ˆå±±ç‚®ç©æ³•ï¼‰
def auth(func,db_type):
    # func=indexçš„å†…å­˜åœ°å€
    def wrapper(*args,**kwargs):
        name=input('your name>>>: ').strip()
        password=input('your password>>>: ').strip()
        if db_type == 'file':
            if name == 'egon' and password == '123':
                print('åŸºäºæ–‡ä»¶çš„éªŒè¯')
                res=func(*args,**kwargs)
                return res
            else:
                print('è´¦å·å¯†ç è¾“å…¥é”™è¯¯')
        elif db_type == 'mysql':
            print('åŸºäºmysqlçš„éªŒè¯')
        elif db_type == 'ldap':
            print('åŸºäºldapçš„éªŒè¯')
        else:
            print('ä¸æ”¯æŒçš„db_type')
    return wrapper

# @auth  # è´¦å·å¯†ç çš„æ¥æºæ˜¯æ–‡ä»¶
def index(x,y):
    print('index==> %s:%s' %(x,y))

# @auth  # è´¦å·å¯†ç çš„æ¥æºæ˜¯æ•°æ®åº“
def home(name):
    print('home==>%s' %name)

# @auth  # è´¦å·å¯†ç çš„æ¥æºæ˜¯ldap
def transfer():
    print('transfer')

index=auth(index, 'file')
home=auth(home, 'mysql')
transfer=auth(transfer, 'ldap')

index(1,2)
home('egon')
transfer()


# ç¤ºä¾‹2ï¼šå±±ç‚®2ç©æ³•
def auth(db_type):
    def deco(func):
        def wrapper(*args,**kwargs):
            name=input('your name>>>: ').strip()
            password=input('your password>>>: ').strip()
            if db_type == 'file':
                if name == 'egon' and password == '123':
                    print('åŸºäºæ–‡ä»¶çš„éªŒè¯')
                    res=func(*args,**kwargs)
                    return res
                else:
                    print('è´¦å·å¯†ç è¾“å…¥é”™è¯¯')
            elif db_type == 'mysql':
                print('åŸºäºmysqlçš„éªŒè¯')
            elif db_type == 'ldap':
                print('åŸºäºldapçš„éªŒè¯')
            else:
                print('ä¸æ”¯æŒçš„db_type')
        return wrapper
    return deco
deco=auth(db_type='file')

@deco  # è´¦å·å¯†ç çš„æ¥æºæ˜¯æ–‡ä»¶
def index(x,y):
    print('index==> %s:%s' %(x,y))

deco=auth(db_type='mysql')
@deco  # è´¦å·å¯†ç çš„æ¥æºæ˜¯æ•°æ®åº“
def home(name):
    print('home==>%s' %name)

deco=auth(db_type='ldap')
@deco  # è´¦å·å¯†ç çš„æ¥æºæ˜¯ldap
def transfer():
    print('transfer')


index(1,2)
home('egon')
transfer()


# ç¤ºä¾‹3ï¼šæœ€ç»ˆç­”æ¡ˆå±•ç¤ºè¯­æ³•ç³–ï¼šæœ‰å‚å‡½æ•°è£…é¥°å™¨
def auth(db_type):
    def deco(func):
        def wrapper(*args,**kwargs):
            name=input('your name>>>: ').strip()
            password=input('your password>>>: ').strip()
            if db_type == 'file':
                if name == 'egon' and password == '123':
                    print('åŸºäºæ–‡ä»¶çš„éªŒè¯')
                    res=func(*args,**kwargs)
                    return res
                else:
                    print('è´¦å·å¯†ç è¾“å…¥é”™è¯¯')
            elif db_type == 'mysql':
                print('åŸºäºmysqlçš„éªŒè¯')
            elif db_type == 'ldap':
                print('åŸºäºldapçš„éªŒè¯')
            else:
                print('ä¸æ”¯æŒçš„db_type')
        return wrapper
    return deco

@auth(db_type='file')  # @deco # index=deco(index) # index=wrapper
def index(x,y):
    print('index==> %s:%s' %(x,y))

@auth(db_type='mysql')  # @deco # home=deco(home) # home=wrapper
def home(name):
    print('home==>%s' %name)

@auth(db_type='ldap')  # @deco # transfer=deco(transfer) # transfer=wrapper
def transfer():
    print('transfer')


index(1,2)
home('egon')
transfer()




```

#### è¡¥å…… æ— å‚è£…é¥°å™¨çš„çŸ¥è¯†ç‚¹
```python
def record_time(func):
    
    def wrapper(*args, **kwargs):
        
        result = func(*args, **kwargs)
        
        return result
    
    return wrapper



ç›¸ä¿¡å¤§å®¶æ³¨æ„åˆ°äº†ï¼Œrecord_timeå‡½æ•°çš„å‚æ•°funcä»£è¡¨äº†ä¸€ä¸ªè¢«è£…é¥°çš„å‡½æ•°ï¼Œå‡½æ•°é‡Œé¢å®šä¹‰çš„wrapperå‡½æ•°æ˜¯å¸¦æœ‰è£…é¥°åŠŸèƒ½çš„å‡½æ•°ï¼Œå®ƒä¼šæ‰§è¡Œè¢«è£…é¥°çš„å‡½æ•°funcï¼Œå®ƒè¿˜éœ€è¦è¿”å›åœ¨æœ€åäº§ç”Ÿå‡½æ•°æ‰§è¡Œçš„è¿”å›å€¼ã€‚ä¸çŸ¥å¤§å®¶æ˜¯å¦ç•™æ„åˆ°ï¼Œä¸Šé¢çš„ä»£ç æˆ‘åœ¨ç¬¬4è¡Œå’Œç¬¬6è¡Œç•™ä¸‹äº†ä¸¤ä¸ªç©ºè¡Œï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿™äº›åœ°æ–¹æ·»åŠ ä»£ç æ¥å®ç°é¢å¤–çš„åŠŸèƒ½ã€‚record_timeå‡½æ•°æœ€ç»ˆä¼šè¿”å›è¿™ä¸ªå¸¦æœ‰è£…é¥°åŠŸèƒ½çš„å‡½æ•°wrapperå¹¶é€šè¿‡å®ƒæ›¿ä»£åŸå‡½æ•°funcï¼Œå½“åŸå‡½æ•°funcè¢«record_timeå‡½æ•°è£…é¥°åï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒæ—¶å…¶å®è°ƒç”¨çš„æ˜¯wrapperå‡½æ•°ï¼Œæ‰€ä»¥æ‰è·å¾—äº†é¢å¤–çš„èƒ½åŠ›ã€‚wrapperå‡½æ•°çš„å‚æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œç”±äºæˆ‘ä»¬è¦ç”¨wrapperæ›¿ä»£åŸå‡½æ•°funcï¼Œä½†æ˜¯æˆ‘ä»¬åˆä¸æ¸…æ¥šåŸå‡½æ•°funcä¼šæ¥å—å“ªäº›å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±é€šè¿‡å¯å˜å‚æ•°å’Œå…³é”®å­—å‚æ•°ç…§å•å…¨æ”¶ï¼Œç„¶ååœ¨è°ƒç”¨funcçš„æ—¶å€™ï¼ŒåŸå°ä¸åŠ¨çš„å…¨éƒ¨ç»™å®ƒã€‚è¿™é‡Œè¿˜è¦å¼ºè°ƒä¸€ä¸‹ï¼ŒPython è¯­è¨€æ”¯æŒå‡½æ•°çš„åµŒå¥—å®šä¹‰ï¼Œå°±åƒä¸Šé¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨record_timeå‡½æ•°ä¸­å®šä¹‰wrapperå‡½æ•°ï¼Œè¿™ä¸ªæ“ä½œåœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­å¹¶ä¸è¢«æ”¯æŒã€‚

çœ‹æ‡‚è¿™ä¸ªç»“æ„åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè®°å½•æ—¶é—´çš„åŠŸèƒ½å†™åˆ°è¿™ä¸ªè£…é¥°å™¨ä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

import time


def record_time(func):

    def wrapper(*args, **kwargs):
        # åœ¨æ‰§è¡Œè¢«è£…é¥°çš„å‡½æ•°ä¹‹å‰è®°å½•å¼€å§‹æ—¶é—´
        start = time.time()
        # æ‰§è¡Œè¢«è£…é¥°çš„å‡½æ•°å¹¶è·å–è¿”å›å€¼
        result = func(*args, **kwargs)
        # åœ¨æ‰§è¡Œè¢«è£…é¥°çš„å‡½æ•°ä¹‹åè®°å½•ç»“æŸæ—¶é—´
        end = time.time()
        # è®¡ç®—å’Œæ˜¾ç¤ºè¢«è£…é¥°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´
        print(f'{func.__name__}æ‰§è¡Œæ—¶é—´: {end - start:.2f}ç§’')
        # è¿”å›è¢«è£…é¥°å‡½æ•°çš„è¿”å›å€¼
        return result
    
    return wrapper


åœ¨ Python ä¸­ï¼Œä½¿ç”¨è£…é¥°å™¨å¾ˆæœ‰æ›´ä¸ºä¾¿æ·çš„è¯­æ³•ç³–ï¼ˆç¼–ç¨‹è¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯ä½¿ç”¨æ›´åŠ æ–¹æ³•ï¼Œä»£ç çš„å¯è¯»æ€§ä¹Ÿæ›´å¼ºï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¹‹ä¸ºâ€œè¯­æ³•ç³–â€æˆ–â€œç³–è¡£è¯­æ³•â€ï¼‰ï¼Œå¯ä»¥ç”¨@è£…é¥°å™¨å‡½æ•°å°†è£…é¥°å™¨å‡½æ•°ç›´æ¥æ”¾åœ¨è¢«è£…é¥°çš„å‡½æ•°ä¸Šï¼Œæ•ˆæœè·Ÿä¸Šé¢çš„ä»£ç ç›¸åŒã€‚æˆ‘ä»¬æŠŠå®Œæ•´çš„ä»£ç ä¸ºå¤§å®¶ç½—åˆ—å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥å†çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨è£…é¥°å™¨çš„ã€‚

import random
import time


def record_time(func):

    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f'{func.__name__}æ‰§è¡Œæ—¶é—´: {end - start:.2f}ç§’')
        return result

    return wrapper


@record_time
def download(filename):
    print(f'å¼€å§‹ä¸‹è½½{filename}.')
    time.sleep(random.random() * 6)
    print(f'{filename}ä¸‹è½½å®Œæˆ.')


@record_time
def upload(filename):
    print(f'å¼€å§‹ä¸Šä¼ {filename}.')
    time.sleep(random.random() * 8)
    print(f'{filename}ä¸Šä¼ å®Œæˆ.')


download('MySQLä»åˆ åº“åˆ°è·‘è·¯.avi')
upload('Pythonä»å…¥é—¨åˆ°ä½é™¢.pdf')

```

<h2 id="zHmfh">2.5  æœ‰å‚è£…é¥°å™¨æ¨¡æ¿</h2>

```python

# æœ‰å‚è£…é¥°å™¨æ¨¡æ¿
def æœ‰å‚è£…é¥°å™¨(x,y,z):   # å¤–å±‚ï¼šæ¥æ”¶è£…é¥°å™¨å‚æ•°
    def outter(func):   # ä¸­å±‚ï¼šæ¥æ”¶è¢«è£…é¥°å‡½æ•°
        def wrapper(*args,**kwargs):  # å†…å±‚ï¼šåŒ…è£¹åŸå‡½æ•°
            res=func(*args,**kwargs)
            return res
        return wrapper
    return outter



@æœ‰å‚è£…é¥°å™¨(1,y=2,z=3)   # ç­‰ä»·äº è¢«è£…é¥°å¯¹è±¡ = æœ‰å‚è£…é¥°å™¨(1,2,3)(è¢«è£…é¥°å¯¹è±¡)
def è¢«è£…é¥°å¯¹è±¡():
    pass

```

å‚è€ƒé“¾æ¥ï¼š[https://zhuanlan.zhihu.com/p/109078881](https://zhuanlan.zhihu.com/p/109078881)



<h2 id="Sy5Sf">2.6 å åŠ å¤šä¸ªè£…é¥°å™¨çš„åˆ†æ(äº†è§£)</h2>

```python

def deco1(func1):
    def wrapper1(*args,**kwargs):
        print('æ­£åœ¨è¿è¡Œ===>deco1.wrapper1')
        res1=func1(*args,**kwargs)
        return res1
    return wrapper1

def deco2(func2):
    def wrapper2(*args,**kwargs):
        print('æ­£åœ¨è¿è¡Œ===>deco2.wrapper2')
        res2=func2(*args,**kwargs)
        return res2
    return wrapper2

def deco3(x):
    def outter3(func3):
        def wrapper3(*args,**kwargs):
            print('æ­£åœ¨è¿è¡Œ===>deco3.outter3.wrapper3')
            res3=func3(*args,**kwargs)
            return res3
        return wrapper3
    return outter3

# åŠ è½½é¡ºåºè‡ªä¸Šè€Œä¸‹ï¼ˆäº†è§£ï¼‰
@deco1       # index=deco1(wrapper2çš„å†…å­˜åœ°å€)        ===> index=wrapper1çš„å†…å­˜åœ°å€
@deco2       # index=deco2(wrapper3çš„å†…å­˜åœ°å€)        ===> index=wrapper2çš„å†…å­˜åœ°å€
@deco3(111)  # ===>@outter3===> index=outter(index) ===> index=wrapper3çš„å†…å­˜åœ°å€

def index(x,y):
    print('from index %s:%s' %(x,y))

# æ‰§è¡Œé¡ºåºï¼šè‡ªä¸Šè€Œä¸‹çš„ï¼Œå³wrapper1--ã€‹wrapper2---ã€‹wrapper3
index(1,2)


# è¾“å‡ºç»“æœï¼š
æ­£åœ¨è¿è¡Œ===>deco1.wrapper1
æ­£åœ¨è¿è¡Œ===>deco2.wrapper2
æ­£åœ¨è¿è¡Œ===>deco3.outter3.wrapper3
from index 1:2

```







![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1680078935695-e9fe3b24-b7a2-4424-a0b1-839b224adb97.png)

<h2 id="h0Vo6">2.7 æ¸©æ•…çŸ¥æ–°</h2>

```python

# æœ‰å‚è£…é¥°å™¨
from functools import wraps
def deco(x,y,z):
    def outter(func):
        @wraps(func)
        def wrapper(*args,**kwargs):
            res=func(*args,**kwargs)
            return res
        return wrapper
    return outter

#åˆ†ææ‰§è¡Œè¿‡ç¨‹:
@deco(1,2,3) ==> @outter ==> åŸå‡½æ•°=outter(è¢«è£…é¥°çš„å‡½æ•°)

```




### ğŸ”— ç›¸å…³é“¾æ¥ï¼š 

https://github.com/jackfrued/Python-100-Days/blob/master/Day01-20/17.%E5%87%BD%E6%95%B0%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8.md

https://zhuanlan.zhihu.com/p/109078881
