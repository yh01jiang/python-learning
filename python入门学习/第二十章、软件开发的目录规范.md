![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1680836149136-ab3f3afd-69e3-43f5-8a4a-e31e157146c6.png)

<font style="color:rgb(18, 18, 18);">为了提高程序的可读性与可维护性，我们应该为软件设计良好的目录结构，这与规范的编码风格同等重要。软件的目录规范并无硬性标准，只要清晰可读即可，假设你的软件名为atm，笔者推荐目录结构如下</font>

```python
ATM/
|-- core/
|   |-- core.py
|
|-- bin/
|   |-- start.py
|
|-- api/
|   |-- api.py
|
|-- db/
|   |-- db_handle.py
|
|-- lib/
|   |-- common.py
|
|-- conf/
|   |-- settings.py
|
|-- run.py
|-- setup.py
|-- requirements.txt
|-- README
```

<font style="color:rgb(18, 18, 18);">简要解释一下:</font>

<font style="color:rgb(18, 18, 18);">• core/: 存放业务逻辑相关代码</font>

<font style="color:rgb(18, 18, 18);">• api/: 存放接口文件，接口主要用于为业务逻辑提供数据操作。</font>

<font style="color:rgb(18, 18, 18);">• db/: 存放操作数据库相关文件，主要用于与数据库交互</font>

<font style="color:rgb(18, 18, 18);">• lib/: 存放程序中常用的自定义模块</font>

<font style="color:rgb(18, 18, 18);">• conf/: 存放配置文件</font>

<font style="color:rgb(18, 18, 18);">• run.py: 程序的启动文件，一般放在项目的根目录下，因为在运行时会默认将运行文件所在的文件夹作为sys.path的第一个路径，这样就省去了处理环境变量的步骤</font>

<font style="color:rgb(18, 18, 18);">• setup.py: 安装、部署、打包的脚本。</font>

<font style="color:rgb(18, 18, 18);">• requirements.txt: 存放软件依赖的外部Python包列表。</font>

<font style="color:rgb(18, 18, 18);">• README: 项目说明文件。</font>

<font style="color:rgb(18, 18, 18);">除此之外，有一些方案给出了更加多的内容，比如LICENSE.txt,ChangeLog.txt文件等，主要是在项目需要开源时才会用到，请读者自行查阅。</font>

<font style="color:rgb(18, 18, 18);">关于README的内容，这个应该是每个项目都应该有的一个文件，目的是能简要描述该项目的信息，让读者快速了解这个项目。它需要说明以下几个事项:</font>

```python
1、软件定位，软件的基本功能；

2、运行代码的方法: 安装环境、启动命令等；

3、简要的使用说明；

4、代码目录结构说明，更详细点可以说明软件的基本原理；

5、常见问题说明。
```

<font style="color:rgb(18, 18, 18);">关于setup.py和requirements.txt：</font>

<font style="color:rgb(18, 18, 18);">一般来说，用setup.py来管理代码的打包、安装、部署问题。业界标准的写法是用Python流行的打包工具setuptools来管理这些事情，这种方式普遍应用于开源项目中。不过这里的核心思想不是用标准化的工具来解决这些问题，而是说，一个项目一定要有一个安装部署工具，能快速便捷的在一台新机器上将环境装好、代码部署好和将程序运行起来。</font>

<font style="color:rgb(18, 18, 18);">requirements.txt文件的存在是为了方便开发者维护软件的依赖库。我们需要将开发过程中依赖库的信息添加进该文件中，避免在 setup.py安装依赖时漏掉软件包，同时也方便了使用者明确项目引用了哪些Python包。</font>

<font style="color:rgb(18, 18, 18);">这个文件的格式是每一行包含一个包依赖的说明，通常是flask>=0.10这种格式，要求是这个格式能被pip识别，这样就可以简单的通过 pip install -r requirements.txt来把所有Python依赖库都装好了，具体格式参照</font>[https://pip.readthedocs.io/en/1](https://link.zhihu.com/?target=https%3A//pip.readthedocs.io/en/1.1/requirements.html)



![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1680839553996-dd048c7b-1f0e-4949-9233-222f07c67e28.png)

<h3 id="pVe20">示例1:   根目录ATM</h3>
ATM\core\src.py

```python
def login():
    print('登录功能')

def register():
    print('注册功能')

def witdraw():
    print('提现功能')

def transfer():
    print('转账功能')

func_dic={
    '0': ['退出',exit],
    '1': ['登录',login],
    '2': ['注册',register],
    '3': ['提现',witdraw],
    '4': ['转账',transfer],
}


def run():
    while True:
        for k in func_dic:
            print(k, func_dic[k][0])
        choice=input('请输入指令编号：').strip()
        if choice in func_dic:
            func_dic[choice][1]()
        else:
            print('请重新输入')
```

ATM\bin\start.py

```python
# 绝对导入参照的是sys.path，sys.path参照的是执行文件。

# 小demo测试
import sys
sys.path.append(r'D:\py1\python\python-project\day16\ATM')  # 但是这样写死了

from conf import settings
from core import src
from db import db_handle
from lib import common

print(src)
print(settings)

# 实现1
from core import src
src.run()

# 实现2
from core.src import run
run()


################优化小测试####################

# 绝对导入参照的是sys.path，sys.path参照的是执行文件。
import os
print(__file__)  # 当前文件的绝对路径  # D:/py1/python/python-project/day16/ATM/bin/start.py
print(os.path.dirname(__file__))  # 查看文件夹名字
print(os.path.dirname(os.path.dirname(__file__))) # 查看父级目录
BASE_DIR=os.path.dirname(os.path.dirname(__file__))

# 输出结果：
D:/py1/python/python-project/day16/ATM/bin/start.py
D:/py1/python/python-project/day16/ATM/bin
D:/py1/python/python-project/day16/ATM



# 优化最终方案
import os
import sys
# print(__file__)  # 当前文件的绝对路径
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
sys.path.append(BASE_DIR)

from core import src

if __name__ == '__main__':
    src.run()

```

<h3 id="RKtO5">示例2:   根目录ATM</h3>
ATM\core\src.py

```python
# 因为logger功能不是核心逻辑，是一个公共逻辑，提取到lib的common.py文件中
# import time
# def logger(msg):
#     with open(r'D:\py1\python\python-project\day16\ATM\log\user.log',
#               mode='at',
#               encoding='utf-8',
#               ) as f:
#         f.write('%s %s\n' %(time.strftime('%Y-%m-%d %H:%M:%S'),msg))



# 导入lib模块
from lib.common import logger
# from lib import common  # 或者使用这种方法，只是调用的时候需要使用common.logger()
def login():
    print('登录功能')
    logger('egon刚刚登录了')

def register():
    print('注册功能')
    logger('egon刚刚注册了')

def witdraw():
    print('提现功能')
    logger('egon刚刚提现了')

def transfer():
    print('转账功能')
    logger('egon刚刚给barry转账3个亿')
func_dic={
    '0': ['退出',exit],
    '1': ['登录',login],
    '2': ['注册',register],
    '3': ['提现',witdraw],
    '4': ['转账',transfer],
}


def run():
    while True:
        for k in func_dic:
            print(k, func_dic[k][0])
        choice=input('请输入指令编号：').strip()
        if choice in func_dic:
            func_dic[choice][1]()
        else:
            print('请重新输入')



```

ATM\lib\common.py

创建log文件夹，收集日志。

```python
# 由于这里吧logger日志的地址写死了，开发过程中一般会把这个路径写在配置文件中，可以让用户自由更改的。conf的setting.py文件



import time
def logger(msg):
    with open(r'D:\py1\python\python-project\day16\ATM\log\user.log',
              mode='at',
              encoding='utf-8',
              ) as f:
        f.write('%s %s\n' %(time.strftime('%Y-%m-%d %H:%M:%S'),msg))
```

ATM\bin\start.py

```python
# 优化方案
import os
import sys
# print(__file__)  # 当前文件的绝对路径
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
sys.path.append(BASE_DIR)

from core import src

if __name__ == '__main__':
    src.run()
```

以上这样操作，代码完全可以运行。



<h3 id="MEwPN">示例3： 优化日志路径写死</h3>
由于这里吧logger日志的地址写死了，开发过程中一般会把这个路径写在配置文件中，可以让用户自由更改的。conf的setting.py文件

配置：ATM\conf\settings.py

```python
LOG_PATH=r'D:\py1\python\python-project\day16\ATM\log\user.log'
```



ATM\lib\common.py

```python
#############优化日志路径写死方案，为了方便以后客户手动配置======
# 导入模块
from conf import settings

import time
def logger(msg):
    with open(settings.LOG_PATH,mode='at',encoding='utf-8',) as f:
        f.write('%s %s\n' %(time.strftime('%Y-%m-%d %H:%M:%S'),msg))
```

ATM\core\src.py

```python
# 因为logger功能不是核心逻辑，是一个公共逻辑，提取到lib的common.py文件中
# import time
# def logger(msg):
#     with open(r'D:\py1\python\python-project\day16\ATM\log\user.log',
#               mode='at',
#               encoding='utf-8',
#               ) as f:
#         f.write('%s %s\n' %(time.strftime('%Y-%m-%d %H:%M:%S'),msg))

# 导入lib模块
from lib.common import logger
# from lib import common  # 或者使用这种方法，只是调用的时候需要使用common.logger()
def login():
    print('登录功能')
    logger('egon刚刚登录了')

def register():
    print('注册功能')
    logger('egon刚刚注册了')

def witdraw():
    print('提现功能')
    logger('egon刚刚提现了')

def transfer():
    print('转账功能')
    logger('egon刚刚给barry转账3个亿')
func_dic={
    '0': ['退出',exit],
    '1': ['登录',login],
    '2': ['注册',register],
    '3': ['提现',witdraw],
    '4': ['转账',transfer],
}


def run():
    while True:
        for k in func_dic:
            print(k, func_dic[k][0])
        choice=input('请输入指令编号：').strip()
        if choice in func_dic:
            func_dic[choice][1]()
        else:
            print('请重新输入')



```



ATM\bin\start.py: 	启动文件

```python
# 优化方案
import os
import sys
# print(__file__)  # 当前文件的绝对路径
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
sys.path.append(BASE_DIR)

from core import src

if __name__ == '__main__':
    src.run()
```



日志文件的记录

![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1680839603359-2a3d40ea-e81a-4e4c-a54f-cdeda1f33855.png)







<h3 id="O7jd7">示例4： 优化日志路径写死====帮助客户自定义路径，即使不修改，拿来就能用</h3>
由于这里吧logger日志的地址写死了，开发过程中一般会把这个路径写在配置文件中，可以让用户自由更改的。conf的setting.py文件

配置：ATM\conf\settings.py

```python
# LOG_PATH=r'D:\py1\python\python-project\day16\ATM\log\user.log'



#################优化方案=========

import os
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
LOG_PATH = r'%s/log/user.log' %BASE_DIR
```



ATM\lib\common.py

```python
#############优化日志路径写死方案，为了方便以后客户手动配置======
# 导入模块
from conf import settings

import time
def logger(msg):
    with open(settings.LOG_PATH,mode='at',encoding='utf-8',) as f:
        f.write('%s %s\n' %(time.strftime('%Y-%m-%d %H:%M:%S'),msg))
```

ATM\core\src.py

```python
# 导入lib模块
from lib.common import logger
# from lib import common  # 或者使用这种方法，只是调用的时候需要使用common.logger()
def login():
    print('登录功能')
    logger('egon刚刚登录了')

def register():
    print('注册功能')
    logger('egon刚刚注册了')

def witdraw():
    print('提现功能')
    logger('egon刚刚提现了')

def transfer():
    print('转账功能')
    logger('egon刚刚给barry转账3个亿')
func_dic={
    '0': ['退出',exit],
    '1': ['登录',login],
    '2': ['注册',register],
    '3': ['提现',witdraw],
    '4': ['转账',transfer],
}


def run():
    while True:
        for k in func_dic:
            print(k, func_dic[k][0])
        choice=input('请输入指令编号：').strip()
        if choice in func_dic:
            func_dic[choice][1]()
        else:
            print('请重新输入')



```



ATM\bin\start.py: 	启动文件

```python
# 优化方案
import os
import sys
# print(__file__)  # 当前文件的绝对路径
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
sys.path.append(BASE_DIR)

from core import src

if __name__ == '__main__':
    src.run()
```



日志文件的记录

![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1680839930667-1e66c5ec-4ea2-4da1-80f6-2e69c79bf23d.png)



<h2 id="YOzKh">补充：开发规范</h2>
1、把代码放在ATM的根目录里面。

![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1681366481344-22862839-1c97-4a07-9c25-6a9f27e24b33.png)

```python
# src/start.py 文件

# 优化方案1
import os
import sys
# print(__file__)  # 当前文件的绝对路径
BASE_DIR=os.path.dirname(os.path.dirname(__file__))
print(BASE_DIR)  # D:/py-project/python/python-project/ATM
sys.path.append(BASE_DIR)

from core import src

if __name__ == '__main__':
    src.run()
```



2、直接把start.py文件放到项目根目录下面，删除bin文件夹



![](https://cdn.nlark.com/yuque/0/2023/png/25700096/1681366805406-8941c65c-0d92-47d3-8a06-7222e702dac8.png)

```python
# import sys
# sys.path的第一个文件夹是当前执行文件所在的文件夹，当前执行文件就在项目的根目录下面，
# 你要把执行文件放到ATM下，就没必要处理环境变量了。
# print(sys.path)


# 直接导模块使用即可
from core import src
src.run()
```

